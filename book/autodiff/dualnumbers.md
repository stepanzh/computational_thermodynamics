---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.16.0
kernelspec:
  display_name: Julia 1.9.4
  language: julia
  name: julia-1.9
---

```{eval-rst}
.. meta::
   :description: –ß–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —à–∞–≥–∞.
   :keywords: –¥—É–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è, –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –≤—ã—á–º–∞—Ç—ã
```

# –î—É–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞

–î—É–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω—ã —Å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏ —Å –Ω–∏–º–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –≤–ø–µ—Ä—ë–¥.

```{index} —á–∏—Å–ª–æ; –¥—É–∞–ª—å–Ω–æ–µ
```
````{proof:definition} –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª
–î—É–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ $\dualset$ —Ä–∞—Å—à–∏—Ä—è—é—Ç[^hypercomplexnumbers] –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ $\real$ —á–∏—Å–ª–æ–º $\dual$, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```{math}
\dual{}  \neq 0, \quad \dual{} \times 0 = 0, \quad \text{–Ω–æ} \quad \dual{} \times \dual{}  = \dual{}^2 = 0.
```

[^hypercomplexnumbers]: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –Ω–∞–∑—ã–≤–∞—é—Ç –≥–∏–ø–µ—Ä–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏. –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ, –¥—É–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞, –∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–≤–∞—Ä—Ç–µ—Ä–∏–æ–Ω—ã —è–≤–ª—è—é—Ç—Å—è –≥–∏–ø–µ—Ä–∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏.
````

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–ª–∞—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–µ $x^2 = 0$ –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–æ—Ä–Ω–µ–π: $0, \dual{}^2, \dual{}^3,\dots$

–û–ø—Ä–µ–¥–µ–ª–∏–º –∑–∞–ø–∏—Å—å –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∑–∞–ø–∏—Å–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö
```{math}
  a + b \dual, \quad a, b \in \real,
```
–≥–¥–µ $a$ –Ω–∞–∑–æ–≤—ë–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç—å—é (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–π) —á–∏—Å–ª–∞, –∞ $b$ --- –¥—É–∞–ª—å–Ω–æ–π.

–°–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã—á–∏—Ç–∞–Ω–∏–µ —á–∏—Å–µ–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ, –ø–æ–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ
```{math}
\begin{align}
\begin{split}
  (a + b \dual) + (c + d \dual) = (a + c) + (b + d)\dual,
  \\
  (a + b \dual) - (c + d \dual) = (a - c) + (b - d)\dual.
\end{split}
\end{align}
```

–ü—Ä–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—Ä–æ–¥–∞ —á–∏—Å–ª–∞ $\dual$
```{math}
(a + b \dual)(c + d \dual) = ac + a d \dual + b c \dual + \cancel{b d \dual^2}
= ac + (a d + b c)\dual.
```
–¢–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–µ–Ω–µ–±—Ä–µ–∂–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω—ã–º–∏ –ø–æ–ø—Ä–∞–≤–∫–∞–º–∏.
–ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ $b\dual$ –∏ $d\dual$ —è–≤–ª—è—é—Ç—Å—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—è–º–∏ –∑–Ω–∞—á–µ–Ω–∏–π $a$ –∏ $c$.
–¢–æ–≥–¥–∞ $b d \dual^2$ –º–∞–ª–æ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–ª–∞–≥–∞–µ–º—ã–º–∏, –∏ –ø—Ä–µ–Ω–µ–±—Ä–µ–≥–∞–µ—Ç—Å—è.

–î–µ–ª–µ–Ω–∏–µ –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–æ–º–Ω–æ–∂–µ–Ω–∏–µ–º —á–∏—Å–ª–∏—Ç–µ–ª—è –∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—è –Ω–∞ —Å–æ–ø—Ä—è–∂—ë–Ω–Ω–æ–µ –∫ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—é (–ø—Ä–∏ —ç—Ç–æ–º –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –Ω–µ–Ω—É–ª–µ–≤–æ–π, $c + d\dual \neq 0$)
```{math}
\frac{a + b\dual}{c + d\dual}
= \frac{(a + b\dual)(c - d \dual)}{(c + d\dual)(c - d\dual)}
= \frac{ac + (-ad + bc)\dual}{c^2}
= \frac{a}{c} + \frac{bc - ad}{c^2}\dual.
```

(sec:autodiff:dual_arithmetic)=
````{proof:definition} –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª
–°–ª–æ–∂–µ–Ω–∏–µ, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º.

```{math}
:label: eq:dual_sumsub
(a + b \dual) \pm (c + d \dual) = (a \pm c) + (b \pm d)\dual.
```

```{math}
:label: eq:dual_mul
(a + b \dual)(c + d \dual) = ac + (a d + b c)\dual.
```

```{math}
:label: eq:dual_div
\frac{a + b\dual}{c + d\dual} = \frac{a}{c} + \frac{bc - ad}{c^2}\dual.
```
````


## –°–≤—è–∑—å —Å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ–º

–ü–æ–ø—Ä–æ–±—É–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é $f$ –æ—Ç –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ $a + b\dual{}$.
–î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ–º –¢–µ–π–ª–æ—Ä–∞
```{math}
f(x) = \sum_{k=0}^{\infty} \frac{f^{(k)}(x_0)}{k!} (x - x_0)^k
```
–∏ –ø—Ä–∏–º–µ–Ω–∏–º –µ–≥–æ –∫ $f(a + b\dual{})$
```{math}
\begin{split}
f(a + b\dual) &= \sum_{k=0}^{\infty} \frac{f^{(k)}(a)}{k!} (a + b\dual - a)^k
= \sum_{k=0}^{\infty} \frac{f^{(k)}(a) b^k \dual^k}{k!}
\\ &= f(a) + b f'(a) \dual + \sum_{k=2}^\infty \frac{f^{(k)}(a) b^k \dual^k}{k!}
\\ &= f(a) + b f'(a) \dual + \dual^2 \sum_{k=2}^\infty \frac{f^{(k)}(a) b^k \dual^{k-2}}{k!}
\\ &= f(a) + b f'(a) \dual.
\end{split}
```

–ó–Ω–∞—á–∏—Ç, –≤—ã—á–∏—Å–ª–∏–≤ —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞, –ø–æ–ª—É—á–∞–µ–º –¥—É–∞–ª—å–Ω–æ–µ —á–∏—Å–ª–æ, –≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∞ –≤ –¥—É–∞–ª—å–Ω–æ–π —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –µ—ë –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è.
(–°—Ä–∞–≤–Ω–∏—Ç–µ —Å {ref}` –º–µ—Ç–æ–¥–æ–º –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —à–∞–≥–∞ <sec:autodiff:complex_step>`.)

–ò—Ç–∞–∫, –¥—É–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ –æ–±–ª–∞–¥–∞—é—Ç —Å–≤–æ–π—Å—Ç–≤–æ–º, –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–º —Å –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

::::{proof:proposition} –ó–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞

```{math}
:label: eq:funcofdual

f(a + b\dual) = f(a) + b f'(a)\dual, \quad a, b \in \real.
```
::::

–û—Ç–º–µ—Ç–∏–º, —á—Ç–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ {eq}`eq:funcofdual` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è _–∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏_ —Ç–æ—á–Ω–æ.

::::{proof:example}

–ù–∏–∂–µ –ø–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ $3 + 2\dual$.
–ß—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç–æ—á–∫—É –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∑–∞–ø–∏—Å—å $[\text{—Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏}](\text{–∞—Ä–≥—É–º–µ–Ω—Ç})$.
–ù–∞–ø—Ä–∏–º–µ—Ä, $[x^2 + 3](4)$ –æ–∑–Ω–∞—á–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ $f(x) = x^2 + 3$ –≤ —Ç–æ—á–∫–µ 4, —Ç.–µ. $[x^2 + 3](4) = 4^2 + 3 = 19$.

- –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞
```{math}
\begin{align*}
f(x) &= 5,
\\ f(3 + 2\dual) &= [5](3) + 2 \times [0](3) \dual = 5.
\end{align*}
```
- –ü–æ–ª–∏–Ω–æ–º
```{math}
\begin{align*}
f(x) &= 4x^3 + x,
\\ f(3 + 2 \dual) &= [4 x^3 + x](3) + 2 \times [12 x^2 + 1](3) \times \dual
\\ &= 111 + 2 \times 109 \times \dual = 111 + 218 \dual.
\end{align*}
```
- –õ–æ–≥–∞—Ä–∏—Ñ–º
```{math}
:label: eq:example_log
\begin{split}
f(x) &= \log x,
\\ f(3 + 2 \dual) &= [\log x](3) + 2 \times [1/x](3) \times \dual
   = \log 3 + \frac{2}{3} \dual.
\end{split}
```
::::

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏.
–î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Å–≤–æ–π—Å—Ç–≤–æ–º {eq}`eq:funcofdual` –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –¥—É–∞–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏ {eq}`eq:dual_sumsub`, {eq}`eq:dual_mul` –∏ {eq}`eq:dual_div`.
–ù–∞—á–Ω—ë–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ —Å–æ –∑–Ω–∞—á–µ–Ω–∏—è —Å—É–º–º—ã —Ñ—É–Ω–∫—Ü–∏–π –≤ —Ç–æ—á–∫–µ $a + b\dual$
```{math}
\begin{split}
f(a + b \dual) + g(a + b \dual)
&= (f(a) + b f'(a) \dual) + (g(a) + b g'(a) \dual)
\\ &= (f(a) + g(a)) + b (f'(a) + g'(a)) \dual.
\end{split}
```
–í –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ —Å—É–º–º—É —Ñ—É–Ω–∫—Ü–∏–π, –∞ –≤ –¥—É–∞–ª—å–Ω–æ–π –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å—É–º–º–∞ –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö.
–ü–æ–ª–æ–∂–∏–º $b = 1$ –∏ –ø–æ–ª—É—á–∏–º
```{math}
f(a + \dual) + g(a + \dual) = (f(a) + g(a)) + (f'(a) + g'(a)) \dual.
```
–¢–µ–ø–µ—Ä—å –≤ –¥—É–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—É–º–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π, –æ–Ω–∞ –∂–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π —Å—É–º–º—ã $(f + g)' = f' + g'$.
–¢–æ –µ—Å—Ç—å,
```{math}
[f + g](a + \dual) = [f + g](a) + [f + g]'(a) \times \dual.
```

–ò—Ç–∞–∫, –º—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø—Ä–∞–≤–∏–ª–æ–º –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É–º–º—ã —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ $a$.
–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—É–º–º–µ —Ñ—É–Ω–∫—Ü–∏–π –≤ $a$, –∞ –¥—É–∞–ª—å–Ω–∞—è --- –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π —Å—É–º–º—ã —Ñ—É–Ω–∫—Ü–∏–π –≤ $a$.
–ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–µ –≤–µ—Ä–Ω–æ –∏ –¥–ª—è –≤—ã—á–∏—Ç–∞–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä–∏–º —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
```{math}
\begin{split}
f(a + \dual) \times g(a + \dual) &= (f(a) + f'(a) \dual) \times (g(a) + g'(a) \dual)
\\ &= f(a) g(a) + (f'(a) g(a) + f(a) g'(a)) \dual.
\end{split}
```
–ò —Å–Ω–æ–≤–∞ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.
–í –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –º—ã –ø–æ–ª—É—á–∏–ª–∏ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π, –∞ –≤ –¥—É–∞–ª—å–Ω–æ–π --- –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π $(fg)' = f'g + fg'$ –≤ —Ç–æ—á–∫–µ $a$
```{math}
[f \times g](a + \dual) = [f \times g](a) + [f \times g]'(a) \times \dual.
```

–ù–∞–∫–æ–Ω–µ—Ü, –ø—Ä–æ–≤–µ—Ä–∏–º –¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
```{math}
\begin{split}
\frac{f(a + \dual)}{g(a + \dual)} &= \frac{f(a) + f'(a) \dual}{g(a) + g'(a) \dual}
\\ &= \frac{f(a)}{g(a)} + \frac{f'(a) g(a) - f(a) g'(a)}{g^2(a)} \dual.
\end{split}
```
–ò —Å–Ω–æ–≤–∞ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ.
–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è –¥–µ–ª–µ–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–π, –∞ –¥—É–∞–ª—å–Ω–∞—è --- –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π –¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π $(f/g)' = (f'g - f g')/g^2$ –≤ —Ç–æ—á–∫–µ $a$
```{math}
[f / g](a + \dual) = [f / g](a) + [f / g]'(a) \dual.
```

–ü–æ—Å–ª–µ–¥–Ω–µ–µ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —ç—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–π (—Å–æ—Å—Ç–∞–≤–Ω–æ–π) —Ñ—É–Ω–∫—Ü–∏–∏
```{math}
g(f(a + \dual)) = g(f(a) + f'(a)\dual) = g(f(a)) + g'(f(a)) f'(a)\dual.
```
–ö–∞–∫ –≤–∏–¥–Ω–æ, –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –ø—Ä–∞–≤–∏–ª–æ–º –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ª–æ–∂–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ $(g(f(x)))' = g'(f(x)) f'(x)$
```{math}
[g \circ f](a + \dual) = [g \circ f](a) + [g \circ f]'(a) \times \dual.
```


## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∫–∞–ª—è—Ä–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –≤—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
–¢–∞–∫, —á—Ç–æ–±—ã –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ—á–∫–µ $f'(x)$, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞ $f(x + \dual)$.
–í –¥—É–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ $f(x + \dual)$ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π $f'(x)$, —Å–æ–≥–ª–∞—Å–Ω–æ {eq}`eq:funcofdual`.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä.
–ó–∞–¥–∞—á–∞: –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–∏ $f(x) = 3 + x \log{x^2}$ –≤ —Ç–æ—á–∫–µ $x = 5$.
–ß—Ç–æ–±—ã –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –±—É–¥—É—â–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, –ø—Ä–∏–≤–µ–¥—ë–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π $f'(x)$

```{math}
f'(x) = \log{x^2} + 2, \quad x \neq 0,
```

–∏ –∑–∞–¥–∞–¥–∏–º —Ñ—É–Ω–∫—Ü–∏—é –∏ –µ—ë –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é –≤ –∫–æ–¥–µ.

```{code-cell}
:tags: [remove-output]
f(x) = 3 + x * log(x^2)
df(x) = log(x^2) + 2
```

–í —Ç–æ—á–∫–µ $x = 5$ –º—ã –æ–∂–∏–¥–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –µ—ë –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π

```{code-cell}
f(5), df(5)
```

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥—ë–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è.
–í–æ-–ø–µ—Ä–≤—ã—Ö, –æ–ø—Ä–µ–¥–µ–ª–∏–º –Ω–æ–≤—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö `Dual` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥—É–∞–ª—å–Ω–æ–≥–æ —á–∏—Å–ª–∞.

```{code-cell}
struct Dual{T<:Real}
    a::T
    b::T
end
```

–í —Å—Ç—Ä—É–∫—Ç—É—Ä–µ `Dual` –≤—Å–µ–≥–æ –¥–≤–∞ –ø–æ–ª—è: –ø–æ–ª–µ `a` —Ö—Ä–∞–Ω–∏—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é —á–∞—Å—Ç—å —á–∏—Å–ª–∞, –∞ –ø–æ–ª–µ `b` —Ö—Ä–∞–Ω–∏—Ç –¥—É–∞–ª—å–Ω—É—é.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º—ã –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–∏, —á—Ç–æ–±—ã —Ç–∏–ø—ã –ø–æ–ª–µ–π –±—ã–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.

–¢–µ–ø–µ—Ä—å —Ä–µ–∞–ª–∏–∑—É–µ–º  {ref}`–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª <sec:autodiff:dual_arithmetic>`.
–î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å–ª–æ–∂–µ–Ω–∏—è –∏ —É–º–Ω–æ–∂–µ–Ω–∏—è.
(–í $f(x)$ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –≤—ã—á–∏—Ç–∞–Ω–∏–µ –∏ –¥–µ–ª–µ–Ω–∏–µ, –∏—Ö —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–µ –±—É–¥–µ–º.)

```{code-cell}
Base.:+(x::Dual, y::Dual) = Dual(x.a + y.a, x.b + y.b)
Base.:*(x::Dual, y::Dual) = Dual(x.a * y.a, x.b * y.a + x.a * y.b)
```

–í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ –µ—Å—Ç—å –µ—â—ë –¥–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: –≤–æ–∑–≤–µ–¥–µ–Ω–∏–µ —á–∏—Å–ª–∞ –≤ —Ü–µ–ª—É—é —Å—Ç–µ–ø–µ–Ω—å –∏ –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—Ä–æ–≤–∞–Ω–∏–µ.
–î–ª—è —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ–π—Å—Ç–≤–æ {eq}`eq:funcofdual`.
–ö–∞–∫ –∏–∑–≤–µ—Å—Ç–Ω–æ –∏–∑ –º–∞—Ç–∞–Ω–∞–ª–∏–∑–∞
```{math}
\begin{align}
(x^n)' &= n x^{n-1}, \quad x \in \real, n \in \integer,
\\ (\log{x})' &= 1 / x, \quad\quad x \in \real, x \neq 0.
\end{align}
```
–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `^` –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∞—Ä–∏—Ñ–º–∞ `log`.

```{code-cell}
Base.:^(x::Dual, n::Int) = Dual(x.a^n, x.b * n * x.a^(n-1))
Base.log(x::Dual) = Dual(log(x.a), x.b / x.a)
```

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Å –¥—É–∞–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏.
–ö–æ–Ω—Å—Ç–∞–Ω—Ç—É 3 –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º –≤ –≤–∏–¥–µ $3 \equiv 3 + 0\times\dual$, –∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –≤ —Ç–æ—á–∫–µ $x = 5 + \dual$.

```{code-cell}
d = Dual(3, 0) + Dual(5, 1) * log(Dual(5, 1)^2)
f(5) == d.a, df(5) == d.b
```

–ö–∞–∫ –≤–∏–¥–Ω–æ, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å —á–∏—Å–ª–∞ `d` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å `f(5)`, –∞ –¥—É–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π –≤ —Ç–æ—á–∫–µ 5 `df(5)`.
–û—Ç–º–µ—Ç–∏–º, —á—Ç–æ —ç—Ç–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ—á–Ω–æ.

–ü—Ä–æ–≤–æ–¥–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `f` —Å –¥—É–∞–ª—å–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏ –ø–æ–∫–∞ –Ω–µ–ª—å–∑—è.
–î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –≤ `f` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–ª–æ–∂–µ–Ω–∏–µ `3::Int` —Å –¥—É–∞–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º `(x * log(x^2))::Dual{Float64}`, —ç—Ç–æ —Å–ª–æ–∂–µ–Ω–∏–µ –º—ã –µ—â—ë –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏.

```{code-cell}
:tags: [raises-exception]

f(Dual(5, 1))
```

–ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞ –¥–æ–æ–ø—Ä–µ–¥–∏–ª–∏—Ç—å —Å–ª–æ–∂–µ–Ω–∏–µ.
–ü–µ—Ä–≤—ã–π —Å–æ—Å—Ç–æ–∏—Ç –≤ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ—Ç–æ–¥–∞ `+(::Int, ::Dual)` –∏ –Ω–∞–º –±—ã –µ–≥–æ —Ö–≤–∞—Ç–∏–ª–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞.
–ú—ã –∂–µ –ø–æ—Å—Ç—É–ø–∏–º –±–æ–ª–µ–µ –æ–±—â–∏–º –¥–ª—è —è–∑—ã–∫–∞ Julia —Å–ø–æ—Å–æ–±–æ–º.
–ú—ã —É–∂–µ –∑–Ω–∞–∫–æ–º—ã —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `promote(xs...)`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω—ã—Ö –∫ "–æ–±—â–µ–º—É" —Ç–∏–ø—É.

```{code-cell}
promote(1, 2.5, 1//3)
```

–í–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –µ–π, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–æ–∂–µ–Ω–∏–µ `Real` —á–∏—Å–µ–ª —Å –¥—É–∞–ª—å–Ω—ã–º–∏ `Dual`.

```{code-cell}
Base.:+(x::Dual, y::Real) = +(promote(x, y)...)
Base.:+(x::Real, y::Dual) = +(promote(x, y)...)
```

–û–¥–Ω–∞–∫–æ, –º—ã –µ—â—ë –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –ø—Ä–∞–≤–∏–ª–∞, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–≤–æ–¥–∏—Ç—å `Real`-—á–∏—Å–ª–∞ –∫ `Dual`-—á–∏—Å–ª–∞–º.
–î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –∑–Ω–∞—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `promote(x::T, y::S)`.
–í –æ–±—â–∏—Ö —á–µ—Ä—Ç–∞—Ö, `promote` –≤—ã—è—Å–Ω—è–µ—Ç "–æ–±—â–∏–π" –¥–ª—è `T` –∏ `S` —Ç–∏–ø `U` —Å –ø–æ–º–æ—â—å—é `promote_type`, –∞ –∑–∞—Ç–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∫ —Ç–∏–ø—É `U` —Å–≤–æ–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã.

```julia
function promote(x::T, y::S) where {T, S}
    U = promote_type(T, S)
    return (convert(U, x), convert(U, y))
end
```

–ù–∞—á–Ω—ë–º —Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏.

```{code-cell}
Base.convert(::Type{Dual{T}}, x::Dual) where {T} = Dual{T}(x.a, x.b)
Base.convert(::Type{Dual{T}}, x::S) where {T, S<:Real} = Dual{T}(x, zero(x))
```

–í –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ—á–∫–µ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é `Dual`-—á–∏—Å–µ–ª –º–µ–∂–¥—É —Å–æ–±–æ–π.
–§–∞–∫—Ç–∏—á–µ—Å–∫–∏, –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –º—ã —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤–æ–µ `Dual` —á–∏—Å–ª–æ, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—è –∏–º–µ—é—Ç –∂–µ–ª–∞–µ–º—ã–π —Ç–∏–ø `T`.
–í–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ—á–∫–µ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é `Real`-—á–∏—Å–ª–∞ –∫ `Dual{T}`-—á–∏—Å–ª—É.
–ö–∞–∫ –Ω–∞–º –∏–∑–≤–µ—Å—Ç–Ω–æ, –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ —ç—Ç–æ –¥—É–∞–ª—å–Ω–æ–µ —Å –Ω—É–ª–µ–≤–æ–π –¥—É–∞–ª—å–Ω–æ–π —á–∞—Å—Ç—å—é.

–¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–π–¥—ë–º –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é `promote_type` –¥–ª—è –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª.
–°–∞–º—É —Ñ—É–Ω–∫—Ü–∏—é `promote_type` –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.
–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –º–µ—Ç–æ–¥ –∫ —Ñ—É–Ω–∫—Ü–∏–∏ `promote_rule(T1, T2)`, –∫–æ—Ç–æ—Ä–∞—è –¥–ª—è –ø–∞—Ä—ã —Ç–∏–ø–æ–≤ `T1` –∏ `T2` (—è–≤–Ω–æ) –∑–∞–¥–∞—ë—Ç –æ–±—â–∏–π.
–í —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, `promote_type` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `promote_rule`, –ø—Ä–∏–º–µ–Ω—è—è –µ—ë –ø–æ–ø–∞—Ä–Ω–æ –∫–æ –≤—Å–µ–º —Å–≤–æ–∏–º –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, `promote_type` –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ —Å–∏–º–º–µ—Ç—Ä–∏–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –ø–æ—ç—Ç–æ–º—É `promote_rule` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–ª—è –ø–∞—Ä—ã –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –æ–¥–∏–Ω —Ä–∞–∑, —Ç.–µ. –ø–∞—Ä–∞ –Ω–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–∞—è.

```{code-cell}
Base.promote_rule(::Type{Dual{T}}, ::Type{Dual{S}}) where {T, S} = Dual{promote_type(T, S)}
Base.promote_rule(::Type{Dual{T}}, ::Type{S}) where {T, S<:Real} = Dual{promote_type(T, S)}
```

–í –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ—á–∫–µ –º—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—â–∏–π —Ç–∏–ø –¥–ª—è –¥–≤—É—Ö –¥—É–∞–ª—å–Ω—ã—Ö.
–ü–æ—Å–∫–æ–ª—å–∫—É `T` –∏ `S` —ç—Ç–æ –ø–æ–¥—Ç–∏–ø—ã `Real` (—Å–º. –≤—ã—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `struct Dual`), —Ç–æ –º—ã –º–æ–∂–µ–º –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `promote_type` –¥–ª—è –Ω–∏—Ö.
–î–ª—è `Real` —á–∏—Å–µ–ª `promote_type` —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ Julia.
–í–æ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–æ—á–∫–µ –¥–ª—è `Dual` –∏ `Real` —á–∏—Å–ª–∞ –º—ã –∑–∞–¥–∞—ë–º `Dual` –∫–∞–∫ –æ–±—â–∏–π —Ç–∏–ø.

–¢–µ–ø–µ—Ä—å `promote` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –Ω–∞—à–∏–º —Ç–∏–ø–æ–º `Dual`.

```{code-cell}
promote(1, 2.5, 1//3, Dual(1, 2))
```

```{code-cell}
promote(1//3, Dual(1, 2))
```

–ù–∞–∫–æ–Ω–µ—Ü, –≤—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π üéâ

```{code-cell}
f(Dual(5, 1))
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π –∫–æ–¥ –∏–∑ –ø—Ä–∏–º–µ—Ä–∞ –≤—ã—à–µ.

```julia
struct Dual{T<:Real}
    a::T
    b::T
end

Base.convert(::Type{Dual{T}}, x::Dual) where {T} = Dual{T}(x.a, x.b)
Base.convert(::Type{Dual{T}}, x::S) where {T, S<:Real} = Dual{T}(x, zero(x))

Base.promote_rule(::Type{Dual{T}}, ::Type{Dual{S}}) where {T, S} = Dual{promote_type(T, S)}
Base.promote_rule(::Type{Dual{T}}, ::Type{S}) where {T, S<:Real} = Dual{promote_type(T, S)}

Base.:+(x::Dual, y::Real) = +(promote(x, y)...)
Base.:+(x::Real, y::Dual) = +(promote(x, y)...)

Base.:+(x::Dual, y::Dual) = Dual(x.a + y.a, x.b + y.b)
Base.:*(x::Dual, y::Dual) = Dual(x.a * y.a, x.b * y.a + x.a * y.b)
Base.:^(x::Dual, n::Int) = Dual(x.a^n, x.b * n * x.a^(n-1))

Base.log(x::Dual) = Dual(log(x.a), x.b / x.a)
```

–≠—Ç–æ—Ç –∫–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏—é $3 + x \log{x^2}$, –Ω–æ –∏ –≤–æ–æ–±—â–µ –ª—é–±—É—é —Å–∫–∞–ª—è—Ä–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Å–æ—Å—Ç–æ—è—â—É—é –∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π —Å–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è, –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è –≤ —Ü–µ–ª—É—é —Å—Ç–µ–ø–µ–Ω—å –∏ –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—Ä–æ–≤–∞–Ω–∏—è.
–ß—Ç–æ–±—ã —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–æ–¥ –Ω–∞ –±–æ–ª—å—à–∏–π –∫–ª–∞—Å—Å —Ñ—É–Ω–∫—Ü–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –æ–ø–µ—Ä–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–ª–∏ $\sin$.
–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–æ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏.

–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥—É–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –æ–±–æ—â–∞–µ—Ç—Å—è –Ω–∞ —Å–ª—É—á–∞–∏ —á–∞—Å—Ç–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã—Ö –≤—ã—Å—à–∏—Ö –ø–æ—Ä—è–¥–∫–æ–≤.
–¢–∞–∫–æ–π –≤–∏–¥ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –ø–∞–∫–µ—Ç–µ [ForwardDiff.jl](https://github.com/JuliaDiff/ForwardDiff.jl).
–° –ø–æ–º–æ—â—å—é ForwardDiff –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—É—é –¥–ª—è –Ω–∞—à–µ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å —Ç–∞–∫.

```{code-cell}
using ForwardDiff

f(x) = 3 + x * log(x^2)
df(x) = ForwardDiff.derivative(f, x)
df(5)
```

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–º–∏ —Å–ø–æ—Å–æ–± –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è _–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–ø–µ—Ä—ë–¥_.
–°–º—ã—Å–ª —Å–ª–æ–≤–∞ "–≤–ø–µ—Ä—ë–¥" —Å–≤—è–∑–∞–Ω —Å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç—å—é —Ü–µ–ø–æ—á–∫–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–æ–π –∏ —Ä–∞–∑—ä—è—Å–Ω—è–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ.
