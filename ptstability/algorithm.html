
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Алгоритм решения &#8212; Практикум по вычислительной теплофизике</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thanks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/proof.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"real": "\\mathbb{R}", "floatset": "\\mathbb{F}", "integer": "\\mathbb{Z}", "macheps": "\\epsilon_{\\text{mach}}", "float": "\\text{float}", "diff": "\\mathrm{d}", "diag": "\\text{diag}", "sign": "\\text{sign}", "part": "\\partial", "lto": "\\leftarrow"}}, "HTML-CSS": {"fonts": ["Latin-Modern"]}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Задания" href="exercise.html" />
    <link rel="prev" title="Уравнение состояния ван дер Ваальса" href="vanderwaals.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Практикум по вычислительной теплофизике</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Предмет практикума
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Практикум
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../julia/index.html">
   1. Основы языка программирования Julia
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/install.html">
     1.1. Установка
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/run.html">
     1.2. Запуск программ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/numbers.html">
     1.3. Числа, переменные, Bool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/strings.html">
     1.4. Строки
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/controlflow.html">
     1.5. Управляющие конструкции
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/functions.html">
     1.6. Функции
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/types_methods_dispatch.html">
     1.7. Типы, методы и multiple dispatch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/arrays.html">
     1.8. Массивы и broadcast
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/linearalgebra.html">
     1.9. Линейная алгебра
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/modules.html">
     1.10. Модули
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../julia/ex.html">
     1.11. Задания
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../intro/index.html">
   2. Введение
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/float.html">
     2.1. Числа с плавающей точкой
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../intro/cond.html">
     2.2. Обусловленность задач
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../syslinear/index.html">
   3. Линейные системы уравнений
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/triangular.html">
     3.1. Треугольные системы
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/lu.html">
     3.2. LU-разложение
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/plu.html">
     3.3. PLU-разложение
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/conditioning.html">
     3.4. Обусловленность линейных систем
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/decompose_overview.html">
     3.5. Обзор других разложений и задач
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../syslinear/ex.html">
     3.6. Задания
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../interpolation/index.html">
   4. Интерполяция
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../interpolation/polynomial.html">
     4.1. Полиномиальная интерполяция
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interpolation/pwlinear.html">
     4.2. Кусочно-линейная интерполяция
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interpolation/cubic_spline.html">
     4.3. Кубические сплайны
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../interpolation/ex.html">
     4.4. Задания
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../integration/index.html">
   5. Численное интегрирование
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../integration/newton_cotes.html">
     5.1. Формулы Ньютона-Котса
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../integration/romberg.html">
     5.2. Метод Ромберга
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../integration/gauss.html">
     5.3. Формулы Гаусса
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../integration/adaptive.html">
     5.4. Адаптивное интегрирование
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../integration/ex.html">
     5.5. Задания
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../nlroot/index.html">
   6. Нелинейные уравнения
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/simpleiter.html">
     6.1. Метод простой итерации
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/newton_secant.html">
     6.2. Метод Ньютона и секущих
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/bisection_regula_falsi.html">
     6.3. Методы бисекции и regula falsi
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/ridders.html">
     6.4. Метод Риддерса
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/itp.html">
     6.5. ITP метод
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../nlroot/ex.html">
     6.6. Задания
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../sysnonlinear/index.html">
   7. Нелинейные системы уравнений
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../sysnonlinear/newton.html">
     7.1. Метод Ньютона
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sysnonlinear/quasinewton.html">
     7.2. Метод Бройдена
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../sysnonlinear/ex.html">
     7.3. Задания
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Фазовое равновесие
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   PT стабильность
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="problem.html">
     Постановка задачи
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="vanderwaals.html">
     Уравнение состояния ван дер Ваальса
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Алгоритм решения
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="exercise.html">
     Задания
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Приложения
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/genindex.html">
   Указатель
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/bibliography.html">
   Литература
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/cholesky.html">
   Разложение Холецкого
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../appendix/materials.html">
   Дополнительные материалы
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/stepanzh/computational_thermodynamics"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/stepanzh/computational_thermodynamics/issues/new?title=Issue%20on%20page%20%2Fptstability/algorithm.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/stepanzh/computational_thermodynamics/edit/main/book/ptstability/algorithm.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/ptstability/algorithm.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Якобиан
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   Грубое и уточнённое решение
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   Начальное приближение
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   Собираем всё вместе
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Алгоритм решения</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id2">
   Якобиан
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   Грубое и уточнённое решение
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   Начальное приближение
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   Собираем всё вместе
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>Алгоритм решения<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h1>
<p>Подытожим, что, по существу, задача свелась к решению нелинейной системы <a class="reference internal" href="problem.html#equation-ptstab-chempot-stationary-system-final">(6)</a> для вектора неизвестных <span class="math notranslate nohighlight">\(\boldsymbol{X}\)</span>.</p>
<p>В качестве используемых переменных в процедурах алгоритма удобно взять</p>
<ul class="simple">
<li><p>состав в мольных долях (а не количество вещества)</p></li>
<li><p>давление</p></li>
<li><p>“тепловую энегию” <span class="math notranslate nohighlight">\(R T\)</span> (температура встречается реже)</p></li>
</ul>
<p>Для вычисления коэффициента летучести удобно пользоваться вторым (безобъёмным) вариантом формулы <a class="reference internal" href="vanderwaals.html#equation-ptstab-fugacity-coef-vdw">(12)</a>.</p>
<p>В качестве солвера нелинейной системы мы возьмём метод Ньютона. Метод требует вычисления Якобиана (матрицы Якоби) системы, об этом будет указано ниже.</p>
<p>После решения системы остаётся вычислить значение функции <span class="math notranslate nohighlight">\(F\)</span> <a class="reference internal" href="problem.html#equation-ptstab-tpd">(3)</a> в найденной точке. Вывод о стабильности термодинамического состояния оставим на пользователя алгоритма, поскольку неравенство <span class="math notranslate nohighlight">\(F &lt; 0\)</span> требует учёта численных ошибок.</p>
<section id="id2">
<h2>Якобиан<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h2>
<p>Мы не будем выводить Якобиан в аналитическом виде, а воспользуемся автоматическим дифференциированием.</p>
<p>Автоматическое дифференциирование это численный способ подсчёта значения функции и её производной (градиента, Якобиана, Гессиана,..) в заданной точке. Один вид автоматического дифференциирования, дифференциирование вперёд, реализован в пакете <a class="reference external" href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>.</p>
<p>Например, решается система <span class="math notranslate nohighlight">\(\boldsymbol{F}(\boldsymbol{x}) = \boldsymbol{0}\)</span> из двух уравнений</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{F}(\boldsymbol{x}) = \begin{bmatrix}
x_1^2 + 3 x_1 x_2 \\
\sin x_2 + x_1 x_2
\end{bmatrix}\end{split}\]</div>
<p>её точный Якобиан имеет вид</p>
<div class="math notranslate nohighlight">
\[\begin{split}\boldsymbol{J}(\boldsymbol{x}) = \begin{bmatrix}
2 x_1 + 3 x_2  &amp;  3 x_1 \\
x_2            &amp;  \cos x_2 + x_1
\end{bmatrix}\end{split}\]</div>
<p>Вычисление по аналитической формуле и дифференциированием вперёд дают одинаковые результаты для точки <span class="math notranslate nohighlight">\(\boldsymbol{p} = [1, 2]^\top\)</span>.</p>
<div class="highlight-julia-repl notranslate"><div class="highlight"><pre><span></span><span class="gp">julia&gt;</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">ForwardDiff</span><span class="w"></span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="go">    x[1]^2 + 3 * x[1] * x[2],</span>
<span class="go">    sin(x[2]) + x[1] * x[2],</span>
<span class="go">]</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">J</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">           </span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">   </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">         </span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w">                  </span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="p">]</span><span class="w"></span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"></span>
<span class="go">2-element Vector{Int64}:</span>
<span class="go"> 1</span>
<span class="go"> 2</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">J</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="go">([7.0, 2.909297426825682], [8.0 3.0; 2.0 0.5838531634528576])</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">ForwardDiff</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="go">2×2 Matrix{Float64}:</span>
<span class="go"> 8.0  3.0</span>
<span class="go"> 2.0  0.583853</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">J</span><span class="p">(</span><span class="n">p</span><span class="p">)[</span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">]</span><span class="w"></span>
<span class="go">0.5838531634528576</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="n">ForwardDiff</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">)[</span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">]</span><span class="w"></span>
<span class="go">0.5838531634528576</span>
</pre></div>
</div>
<p>Автоматическое дифференциирование имеет два преимущества в сравнении с заданием Якобиана аналитически. Во-первых, оно избавляет нас от вывода Якобиана. Во-вторых, если пользователь захочет задать своё уравнение состояния, то в качестве Якобиана <em>по умолчанию</em> мы можем оставить автоматический вариант, язык Julia сильно нам в этом помогает.</p>
<p>В свою очередь, платой является скорость работы.</p>
<p>И хотя вывести Якобиан для кубического уравнения не слишком сложно, с начала 2000-х годов набирают популярность уравнения состояния из семейства <a class="reference external" href="https://en.wikipedia.org/wiki/Statistical_associating_fluid_theory">SAFT</a>. Можете оценить объём работы по выводу производных: см. первые и вторые производные свободной энергии Гельмгольца в приложении статьи <span id="id3">[<a class="reference internal" href="../appendix/bibliography.html#id20" title="Joachim Gross and Gabriele Sadowski. Perturbed-chain SAFT: an equation of state based on a perturbation theory for chain molecules. Industrial &amp; Engineering Chemistry Research, 40(4):1244–1260, 2001. URL: https://pubs.acs.org/doi/10.1021/ie0003887 (visited on 2022-03-25), doi:10.1021/ie0003887.">GS01</a>]</span>. Вероятно, кто-нибудь однажды сделает возможным задавать уравнения в исходном коде символьно, символьно их дифференциировать и компилировать эффективную версию (аналитическую реализацию).<a class="footnote-reference brackets" href="#idea-disclaimer" id="id4">1</a></p>
</section>
<section id="id5">
<h2>Грубое и уточнённое решение<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h2>
<p>Сходимость метода Ньютона чувствительна к точности начального приближения. Практика показывает, что, при нахождении начального приближения далеко от решения, метод может не сойтись.</p>
<p>Чтобы увеличить отказоустойчивость (робастность, англ. <em>robust</em>) алгоритма, будем искать решение в два этапа. На первом этапе найдём грубое решение системы методом простой итерации с исходным начальным приближением. Соответствующая система на неподвижную точку (сравните с <a class="reference internal" href="problem.html#equation-ptstab-chempot-stationary-system-final">(6)</a>) имеет вид</p>
<div class="math notranslate nohighlight" id="equation-ptstab-chempot-stationary-system-ssi">
<span class="eqno">(15)<a class="headerlink" href="#equation-ptstab-chempot-stationary-system-ssi" title="Permalink to this equation">#</a></span>\[\ln{X_i^{k+1}} = h_i - \ln{\varphi_i(X^k_i)},\quad i=1,\dots,n.\]</div>
<p>В этой системе вектор неизвестных – <span class="math notranslate nohighlight">\([\ln{X_1}, \dots, \ln{X_n}]^\top\)</span>.</p>
<p>Бывают разные критерии остановки при поиске грубого решения. Обычно, даже если норма грубого решения системы превышает заданную точность, уточняющий второй этап всё равно проводят. Иногда норму решения не проверяют, производя несколько простых итераций.</p>
<p>На втором этапе воспользуемся методом Ньютона для уточнения решения, в качестве начального приближения возьмём грубое решение задачи.</p>
</section>
<section id="id6">
<h2>Начальное приближение<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h2>
<p>Начальные приближения можно найти, например, положив условия смешения в двухфазном состоянии идеальными. Скажем, в качестве новой фазы образуется пузырик смеси идеальных газов или капля идеального раствора.</p>
<p>Для углеводородов найдены более подходящие начальные условия. Мы воспользуемся следующим приближением <span id="id7">[<a class="reference internal" href="../appendix/bibliography.html#id17" title="Michael L. Michelsen. The isothermal flash problem. part i. stability. Fluid Phase Equilibria, 9(1):1–19, 1982. URL: https://linkinghub.elsevier.com/retrieve/pii/0378381282850012 (visited on 2022-03-14), doi:10.1016/0378-3812(82)85001-2.">Mic82</a>]</span></p>
<div class="math notranslate nohighlight">
\[\frac{\text{доля комп. в газе}}{\text{доля комп. в жидкости}} \equiv K_i
= \frac{P_{c,i}}{P} \exp\big[5.42 (1 - T_{c,i}/T)\big]\]</div>
<p>где <span class="math notranslate nohighlight">\(K_i\)</span> – константа равновесия, <span class="math notranslate nohighlight">\(P_{c,i}\)</span> и <span class="math notranslate nohighlight">\(T_{c,i}\)</span> критические давление и температура компонента <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>Начальных условий два и тестировать нужно оба</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(X_i = K_i z_i\)</span> – образование пузырька пара в жидкости;</p></li>
<li><p><span class="math notranslate nohighlight">\(X_i = z_i / K_i\)</span> – образование капли конденсата в газе.</p></li>
</ul>
<p>Здесь мы пользуемся <span class="math notranslate nohighlight">\(X_i\)</span> как составом в мольных долях (см. <a class="reference internal" href="problem.html#equation-ptstab-new-variables-molfrac-property">(7)</a>).</p>
<p>Алгоритму стабильности также понадобится сообщить типы фаз: тип фазы в однофазном состоянии и тип фазы-зародыша в двухфазном состоянии. Поскольку начальных приближений два, то всего может получиться до <span class="math notranslate nohighlight">\(2^3 = 8\)</span> вариантов. В простом случае достаточно воспользоваться двумя вариантами</p>
<ul class="simple">
<li><p>Однофазный газ, в двухфазном состоянии фаза-зародыш – жидкость (капля конденсата);</p></li>
<li><p>Однофазная жидкость, в двухфазном состоянии фаза-зародыш – газ (пузырёк пара).</p></li>
</ul>
</section>
<section id="id8">
<h2>Собираем всё вместе<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h2>
<p>Входные данные алгоритма</p>
<ul class="simple">
<li><p>“Уравнение состояния”: параметры всех компонентов, правила смешения;</p></li>
<li><p>Состав смеси (в мольных долях <span class="math notranslate nohighlight">\(\boldsymbol{z}\)</span> или количества веществ <span class="math notranslate nohighlight">\(\boldsymbol{N}\)</span>);</p></li>
<li><p>Давление смеси <span class="math notranslate nohighlight">\(P\)</span>;</p></li>
<li><p>“Температура” смеси <span class="math notranslate nohighlight">\(R T\)</span>;</p></li>
<li><p>Начальное приближение решения системы <a class="reference internal" href="problem.html#equation-ptstab-chempot-stationary-system-final">(6)</a> <span class="math notranslate nohighlight">\(\boldsymbol{X}^0\)</span>;</p></li>
<li><p>Пометка о типе однофазного состояния (газ или жидкость);</p></li>
<li><p>Пометка о типе фазы-зародыша (газ или жидкость).</p></li>
</ul>
<p>Выходные данные алгоритма</p>
<ul class="simple">
<li><p>Флаг “было ли найдено решение”, т.е. сошёлся ли алгоритм;</p></li>
<li><p>Состав в мольных долях фазы-зародыша <span class="math notranslate nohighlight">\(\boldsymbol{x}^*\)</span>;</p></li>
<li><p>Значение функции <span class="math notranslate nohighlight">\(F\)</span> <a class="reference internal" href="problem.html#equation-ptstab-tpd">(3)</a> при найденном составе <span class="math notranslate nohighlight">\(\boldsymbol{x}^*\)</span>.</p></li>
</ul>
<p>Как упоминалось ранее, ответственность об определении стабильности по значению <span class="math notranslate nohighlight">\(F\)</span> ложится на пользователя алгоритма.</p>
<p>Этапы алгоритма</p>
<ol class="simple">
<li><p>Поиск грубого решения исходной системы методом простой итерации <a class="reference internal" href="#equation-ptstab-chempot-stationary-system-ssi">(15)</a>;</p></li>
<li><p>Формирование системы <a class="reference internal" href="problem.html#equation-ptstab-chempot-stationary-system-final">(6)</a> и её Якобиана для использования в методе Ньютона;</p></li>
<li><p>Запуск метода Ньютона для системы <a class="reference internal" href="problem.html#equation-ptstab-chempot-stationary-system-final">(6)</a> при начальном приближении, найдённом на шаге 1;</p></li>
<li><p>Подсчёт состава фазы-зародыша <span class="math notranslate nohighlight">\(\boldsymbol{x}^*\)</span> (см. <a class="reference internal" href="problem.html#equation-ptstab-new-variables-molfrac-property">(7)</a>) и <span class="math notranslate nohighlight">\(F(\boldsymbol{x}^*)\)</span> из найденного решения <span class="math notranslate nohighlight">\(\boldsymbol{X}^*\)</span>.</p></li>
</ol>
<p>Если на шаге 3 заданная точность решения не была достигнута, в выходных данных результат помечают как не найденный. Тем не менее, если значение <span class="math notranslate nohighlight">\(F(\boldsymbol{x}^*) \ll 0\)</span>, то однофазное состояние можно трактовать как нестабильное.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="idea-disclaimer"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>Может оказаться, что такой способ уже изобретён, но авторам он неизвестен на момент составления практикума. Сообщите нам, если знаете.</p>
</dd>
</dl>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./ptstability"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="vanderwaals.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Уравнение состояния ван дер Ваальса</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="exercise.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Задания</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Степан Захаров и Василий Писарев<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>