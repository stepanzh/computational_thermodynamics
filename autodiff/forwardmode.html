

<!DOCTYPE html>


<html lang="ru" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="Данный раздел посвящён автоматическому дифференцированию вперёд (forward mode)." name="description" />
<meta content="дуальное число, автоматическое дифференцирование вперед, forward mode, forward accumulation, autodiff, forwarddiff, автоматическое дифференцирование, производная, вычислительная математика, вычматы" name="keywords" />

    <title>8.4. Автоматическое дифференцирование вперёд &#8212; Практикум по вычислительной теплофизике</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thanks.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/proof.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmin": "\\operatorname{argmin}", "const": "\\text{const}", "diag": "\\text{diag}", "diff": "\\mathrm{d}", "dual": "\\varepsilon", "dualset": "\\mathbb{D}", "float": "\\text{float}", "floatset": "\\mathbb{F}", "integer": "\\mathbb{Z}", "lto": "\\leftarrow", "macheps": "\\epsilon_{\\text{mach}}", "part": "\\partial", "real": "\\mathbb{R}", "sign": "\\text{sign}", "vapor": "\\text{\u043f\u0430\u0440}", "liquid": "\\text{\u0436\u0438\u0434\u043a.}"}}, "HTML-CSS": {"fonts": ["Latin-Modern"]}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'autodiff/forwardmode';</script>
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" />
    <link rel="next" title="8.5. Автоматическое дифференцирование назад" href="backwardmode.html" />
    <link rel="prev" title="8.3. Граф вычислений" href="compgraph.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ru"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Перейти к основному содержанию</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Практикум по вычислительной теплофизике</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    О практикуме
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Практикум</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../julia/index.html">1. Основы языка программирования Julia</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../julia/install.html">1.1. Установка</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/run.html">1.2. Запуск программ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/numbers.html">1.3. Числа, переменные, Bool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/strings.html">1.4. Строки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/controlflow.html">1.5. Управляющие конструкции</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/functions.html">1.6. Функции</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/types_methods_dispatch.html">1.7. Типы, методы и multiple dispatch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/arrays.html">1.8. Массивы и broadcast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/linearalgebra.html">1.9. Линейная алгебра</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/modules.html">1.10. Модули и пакеты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../julia/ex.html">1.11. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro/index.html">2. Введение</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro/float.html">2.1. Числа с плавающей точкой</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro/cond.html">2.2. Обусловленность задач</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../syslinear/index.html">3. Линейные системы уравнений</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/triangular.html">3.1. Треугольные системы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/lu.html">3.2. LU-разложение</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/plu.html">3.3. PLU-разложение</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/conditioning.html">3.4. Обусловленность линейных систем</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/decompose_overview.html">3.5. Обзор других разложений и задач</a></li>
<li class="toctree-l2"><a class="reference internal" href="../syslinear/ex.html">3.6. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../interpolation/index.html">4. Интерполяция</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../interpolation/polynomial.html">4.1. Полиномиальная интерполяция</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpolation/pwlinear.html">4.2. Кусочно-линейная интерполяция</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpolation/cubic_spline.html">4.3. Кубические сплайны</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interpolation/ex.html">4.4. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../integration/index.html">5. Численное интегрирование</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../integration/newton_cotes.html">5.1. Формулы Ньютона-Котса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integration/romberg.html">5.2. Метод Ромберга</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integration/gauss.html">5.3. Формулы Гаусса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integration/adaptive.html">5.4. Адаптивное интегрирование</a></li>
<li class="toctree-l2"><a class="reference internal" href="../integration/ex.html">5.5. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../nlroot/index.html">6. Нелинейные уравнения</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/simpleiter.html">6.1. Метод простой итерации</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/newton_secant.html">6.2. Метод Ньютона и секущих</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/bisection_regula_falsi.html">6.3. Методы бисекции и regula falsi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/ridders.html">6.4. Метод Риддерса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/itp.html">6.5. ITP метод</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nlroot/ex.html">6.6. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sysnonlinear/index.html">7. Нелинейные системы уравнений</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../sysnonlinear/newton.html">7.1. Метод Ньютона</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysnonlinear/quasinewton.html">7.2. Метод Бройдена</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysnonlinear/ex.html">7.3. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">8. Автоматическое дифференцирование</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="complexstep.html">8.1. Метод комплексного шага</a></li>
<li class="toctree-l2"><a class="reference internal" href="dualnumbers.html">8.2. Дуальные числа</a></li>
<li class="toctree-l2"><a class="reference internal" href="compgraph.html">8.3. Граф вычислений</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">8.4. Автоматическое дифференцирование вперёд</a></li>
<li class="toctree-l2"><a class="reference internal" href="backwardmode.html">8.5. Автоматическое дифференцирование назад</a></li>
<li class="toctree-l2"><a class="reference internal" href="oja_problem.html">8.6. Оптимальное вычисление матрицы Якоби</a></li>
<li class="toctree-l2"><a class="reference internal" href="ex.html">8.7. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ode/index.html">9. Обыкновенные дифференциальные уравнения</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ode/euler.html">9.1. Метод Эйлера</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ode/rungekutta.html">9.2. Методы Рунге-Кутты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ode/adaptive_rungekutta.html">9.3. Адаптивные методы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ode/ex.html">9.4. Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../optim/index.html">10. Задача оптимизации</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../optim/intro.html">10.1. Предварительные сведения</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optim/linesearch.html">10.2. Поиск вдоль направления</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optim/newton.html">10.3. Метод Ньютона</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optim/bfgs.html">10.4. Метод BFGS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optim/ex.html">10.5. Задания</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Фазовое равновесие</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../ptstability/index.html">PT стабильность</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ptstability/problem.html">Постановка задачи</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptstability/vanderwaals.html">Уравнение состояния ван дер Ваальса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptstability/algorithm.html">Алгоритм решения</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptstability/exercise.html">Задания</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ptsplit/index.html">PT расслоение</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../ptsplit/problem.html">Постановка задачи</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ptsplit/solution.html">Решение задачи</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Приложения</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Указатель</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/bibliography.html">Литература</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/materials.html">Дополнительные материалы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/solvecubic.html">Решение кубического уравнения</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/cholesky.html">Разложение Холецкого</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/stepanzh/computational_thermodynamics" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Исходный репозиторий"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/stepanzh/computational_thermodynamics/edit/main/book/autodiff/forwardmode.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/stepanzh/computational_thermodynamics/issues/new?title=Issue%20on%20page%20%2Fautodiff/forwardmode.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Открыть вопрос"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Загрузите эту страницу">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/autodiff/forwardmode.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Скачать исходный файл"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Распечатать в PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Полноэкранный режим"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="светлая/темная" aria-label="светлая/темная" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Поиск" aria-label="Поиск" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Автоматическое дифференцирование вперёд</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Содержание </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.4.1. Общий случай</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">8.4.2. Быстродействие и применимость</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sec-autodiff-forwardmode">
<span id="id1"></span><h1><span class="section-number">8.4. </span>Автоматическое дифференцирование вперёд<a class="headerlink" href="#sec-autodiff-forwardmode" title="Permalink to this heading">#</a></h1>
<p id="index-0"><strong>Автоматическое дифференцирование вперёд</strong> (прямое, forward mode, forward accumulation) является видом автоматического дифференцирования, в котором вычисления производных распространяются от аргументов функции к её результату.
Впервые этот метод дифференцирования был представлен R.E. Wengert <span id="id2">[<a class="reference internal" href="../appendix/bibliography.html#id28" title="R. E. Wengert. A simple automatic derivative evaluation program. Communications of the ACM, 7(8):463–464, 1964. doi:10.1145/355586.364791.">Wen64</a>]</span>.</p>
<p>Сначала мы продемонстируем работу алгоритма на частном примере функции из <a class="reference internal" href="compgraph.html#sec-autodiff-compgraph"><span class="std std-numref">Раздела 8.3</span></a>, а затем опишем общий случай.
Ниже показана функция из примера и её граф вычисления.</p>
<div class="math notranslate nohighlight">
\[f(x_1, x_2, x_3) = \frac{x_1 x_2 + \sin{x_3}}{x_3}\]</div>
<figure class="align-default" id="fig-autodiff-graph-example-forward">
<img alt="../_images/graph-example.svg" src="../_images/graph-example.svg" /><figcaption>
<p><span class="caption-number">Рис. 8.5 </span><span class="caption-text">Граф вычислений функции <span class="math notranslate nohighlight">\(f(x_1, x_2, x_3) = (x_1 x_2 + \sin{x_3})/x_3\)</span>.</span><a class="headerlink" href="#fig-autodiff-graph-example-forward" title="Постоянная ссылка на рисунок">#</a></p>
</figcaption>
</figure>
<p>Поставим задачу вычисления первой частной производной <span class="math notranslate nohighlight">\(\partial f / \partial x_1\)</span>.
Будем считать, что <span class="math notranslate nohighlight">\(f\)</span> это сложная (композитная) функция от промежуточных значений.
Например, можно сказать, что <span class="math notranslate nohighlight">\(f\)</span> <em>явно</em> зависит от <span class="math notranslate nohighlight">\(x_3\)</span> и <span class="math notranslate nohighlight">\(x_6\)</span>, которые, в свою очередь, <em>неявно</em> зависят (или не зависят) от <span class="math notranslate nohighlight">\(x_1\)</span>.
Это позволит нам воспользоваться правилом дифференцирования сложной функции и, в конечном итоге, получить производную <span class="math notranslate nohighlight">\(\partial f / \partial x_1\)</span>.</p>
<p>Итак, наша задача найти все частные производные вида</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_j}{\partial x_1}, \quad j = 1, \dots, 7.\]</div>
<p>Часть этих производных нулевые, а при <span class="math notranslate nohighlight">\(j = 7\)</span> мы получим <span class="math notranslate nohighlight">\(\partial x_7 / \partial x_1 \equiv \partial f / \partial x_1\)</span>, т.е. искомую частную производную.</p>
<p><strong>Шаг 1.</strong>
Произведём инициализацию алгоритма.
Нам известны значения аргументов <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span>, <span class="math notranslate nohighlight">\(x_3\)</span> и их частные производные по <span class="math notranslate nohighlight">\(x_1\)</span></p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_1}{\partial x_1} = 1,
\quad \frac{\partial x_2}{\partial x_1}
= \frac{\partial x_3}{\partial x_1}
= 0.\]</div>
<p>Запомним их.</p>
<p><strong>Шаг 2.</strong>
Найдём производную <span class="math notranslate nohighlight">\(\partial x_4 / \partial x_1\)</span>.
Для этого считаем <span class="math notranslate nohighlight">\(x_4\)</span> сложной функцией в соответствии с графом вычисления (см. аргументы вычисления <span class="math notranslate nohighlight">\(x_4\)</span> на <a class="reference internal" href="#fig-autodiff-graph-example-forward"><span class="std std-numref">Рисунке 8.5</span></a>)</p>
<div class="math notranslate nohighlight">
\[x_4 = x_4(x_1, x_2) = x_1 \times x_2(x_1) = x_4(x_1)\]</div>
<p>и получим</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_4}{\partial x_1}
= \frac{\partial x_1}{\partial x_1} x_2 + x_1 \frac{\partial x_2}{\partial x_1}
= 1 \times x_2 + x_1 \times 0
= x_2.\]</div>
<p>Здесь мы воспользовались правилом дифференцирования произведения.
Производные <span class="math notranslate nohighlight">\(\partial x_1 / \partial x_1 = 1\)</span> и <span class="math notranslate nohighlight">\(\partial x_2 / \partial x_1 = 0\)</span> нам известны с шага 1.
В конце шага запомним не только производную <span class="math notranslate nohighlight">\(\partial x_4 / \partial x_1\)</span>, но и значение <span class="math notranslate nohighlight">\(x_4 = x_1 x_2\)</span>.</p>
<p><strong>Шаг 3.</strong>
Найдём производную <span class="math notranslate nohighlight">\(\partial x_5 / \partial x_1\)</span>.
Поступая также, как на шаге 2, посчитаем <span class="math notranslate nohighlight">\(x_5\)</span> сложной функцией от <span class="math notranslate nohighlight">\(x_3\)</span></p>
<div class="math notranslate nohighlight">
\[x_5 = x_5(x_3) = \sin{x_3(x_1)} = x_5(x_1),\]</div>
<p>тогда</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_5}{\partial x_1}
= \frac{\partial x_5}{\partial x_3} \frac{\partial x_3}{\partial x_1}
= \cos{x_3} \times 0
= 0.\]</div>
<p>Здесь мы воспользовались правилом дифференцирования сложной функции и производной функции синуса.
Производная <span class="math notranslate nohighlight">\(\partial x_3 / \partial x_1 = 0\)</span> известна с шага 1.
Как и на шаге 2, запомним <span class="math notranslate nohighlight">\(x_5 = \sin{x_3}\)</span> и <span class="math notranslate nohighlight">\(\partial x_5 / \partial x_1\)</span>.</p>
<p><strong>Шаг 4.</strong>
Найдём производную <span class="math notranslate nohighlight">\(\partial x_6 / \partial x_1\)</span>.
Значение <span class="math notranslate nohighlight">\(x_6\)</span> явно вычисляется по <span class="math notranslate nohighlight">\(x_4\)</span> и <span class="math notranslate nohighlight">\(x_5\)</span></p>
<div class="math notranslate nohighlight">
\[x_6 = x_6(x_4, x_5) = x_4(x_1) + x_5(x_1) = x_6(x_1),\]</div>
<p>тогда</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_6}{\partial x_1}
= \frac{\partial x_4}{\partial x_1} + \frac{\partial x_5}{\partial x_1}
= x_2 + 0
= x_2\]</div>
<p>Здесь мы воспользовались правилом дифференцирования суммы функций и значениями производных, полученных на шагах 2 и 3.
Запомним значение <span class="math notranslate nohighlight">\(x_6 = x_4 + x_5 = x_1 x_2 + \sin{x_3}\)</span> и производную <span class="math notranslate nohighlight">\(\partial x_6 / \partial x_1\)</span>.</p>
<p><strong>Шаг 5.</strong>
Последний шаг, найдём производную <span class="math notranslate nohighlight">\(\partial x_7 / \partial x_1 \equiv \partial f / \partial x_1\)</span>.
Значение <span class="math notranslate nohighlight">\(x_7\)</span> явно определяется по значениям <span class="math notranslate nohighlight">\(x_3\)</span> и <span class="math notranslate nohighlight">\(x_6\)</span></p>
<div class="math notranslate nohighlight">
\[x_7 = x_7(x_3, x_6) = \frac{x_6(x_1)}{x_3(x_1)},\]</div>
<p>а производная по <span class="math notranslate nohighlight">\(x_1\)</span> имеет вид</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_7}{\partial x_1}
= \frac{ (\partial x_6 / \partial x_1 ) \times x_3 - x_6 \times (\partial x_3 / \partial x_1) }{ x^2_3 }
= \frac{x_2 \times x_3 - x_6 \times 0}{x^2_3}
= \frac{x_2}{x_3}
, \quad x_3 \neq 0.\]</div>
<p>Здесь мы воспользовались правилом дифференцирования деления функций и значениями производных с шагов 1 и 4.
Таким образом, мы вычислили значение первой компоненты градиента функции <span class="math notranslate nohighlight">\(\partial f / \partial x_1\)</span>.</p>
<p>Отметим, что все промежуточные значения и производные выражались на протяжении алгоритма через значения аргументов функции <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(x_2\)</span> и <span class="math notranslate nohighlight">\(x_3\)</span>.
При этом промежуточные значения и производные мы получали в направлении «слева-направо» по графу вычислений, т.е. от аргументов к результату <span class="math notranslate nohighlight">\(x_7 \equiv f\)</span>.
На <a class="reference internal" href="#fig-autodiff-graph-forward-aux"><span class="std std-numref">Рисунке 8.6</span></a> показан граф вычисления значения функции <span class="math notranslate nohighlight">\(f\)</span> и её производной <span class="math notranslate nohighlight">\(\partial f / \partial x_1\)</span> в точке <span class="math notranslate nohighlight">\([1, 2, 3]^\top\)</span>.</p>
<figure class="align-default" id="fig-autodiff-graph-forward-aux">
<img alt="../_images/graph-forward-auxillary-values.svg" src="../_images/graph-forward-auxillary-values.svg" /><figcaption>
<p><span class="caption-number">Рис. 8.6 </span><span class="caption-text">Граф вычисления <span class="math notranslate nohighlight">\(f(1, 2, 3)\)</span> и <span class="math notranslate nohighlight">\(\partial f / \partial x_1 (1, 2, 3)\)</span>.
Вычисления распространяются «слева-направо».
У каждой вершины подписаны значение промежуточной величины <span class="math notranslate nohighlight">\(x_i\)</span> и производной <span class="math notranslate nohighlight">\(\partial x_i / \partial x_1\)</span>.
Напоминает <a class="reference internal" href="dualnumbers.html#sec-autodiff-dualnumbers"><span class="std std-ref">дуальные числа</span></a>?</span><a class="headerlink" href="#fig-autodiff-graph-forward-aux" title="Постоянная ссылка на рисунок">#</a></p>
</figcaption>
</figure>
<section id="id3">
<h2><span class="section-number">8.4.1. </span>Общий случай<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h2>
<p>В общем случае задача автоматического дифференцирования сводится к поиску всех производных вида</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_j}{\partial x_i}, \quad j = 1,\dots,V,\ i = 1,\dots,n,\ V \ge n,\]</div>
<p>где <span class="math notranslate nohighlight">\(x_1\)</span>, …, <span class="math notranslate nohighlight">\(x_n\)</span> это аргументы функции, а <span class="math notranslate nohighlight">\(x_1\)</span>, …, <span class="math notranslate nohighlight">\(x_V\)</span> промежуточные значения в графе вычислений.
В примере выше аргументов было <span class="math notranslate nohighlight">\(n = 3\)</span>, а промежуточных значений <span class="math notranslate nohighlight">\(V = 7\)</span>.</p>
<p>Автоматическое дифференцирование по-разному пользуется правилом дифференцирования сложной (композитной) функции.
В случае дифференцирования вперёд промежуточное значение <span class="math notranslate nohighlight">\(x_j\)</span> представляется в виде функции</p>
<div class="math notranslate nohighlight" id="equation-eq-forwarddiff-general-xj">
<span class="eqno">(8.7)<a class="headerlink" href="#equation-eq-forwarddiff-general-xj" title="Ссылка на это уравнение">#</a></span>\[x_j = x_j( \{ x_k(x_i) \}_{k \in K} ) = x_j(x_i),\]</div>
<p>где <span class="math notranslate nohighlight">\(\{x_k\}_{k \in K}\)</span> это промежуточные значения, от которых <span class="math notranslate nohighlight">\(x_j\)</span> зависит явно, непосредственно (а <span class="math notranslate nohighlight">\(K\)</span> это множество индексов таких вершин).
Т.е. на графе вычислений <span class="math notranslate nohighlight">\(\{x_k\}_{k \in K}\)</span> это вершины, которые связаны с <span class="math notranslate nohighlight">\(x_j\)</span> стоком.</p>
<figure class="align-default" id="fig-autodiff-graph-forward-general">
<img alt="../_images/graph-forward-general.svg" src="../_images/graph-forward-general.svg" /><figcaption>
<p><span class="caption-number">Рис. 8.7 </span><span class="caption-text">Общая схема графа вычислений <span class="math notranslate nohighlight">\(\partial x_j / \partial x_i\)</span> для автоматического дифференцирования вперёд.
Явные связи (дуги графа) показаны прямыми стрелками, а неявные связи показаны волнистыми стрелками.</span><a class="headerlink" href="#fig-autodiff-graph-forward-general" title="Постоянная ссылка на рисунок">#</a></p>
</figcaption>
</figure>
<p>Применяя к представлению функции <span class="math notranslate nohighlight">\(x_j\)</span> в виде <a class="reference internal" href="#equation-eq-forwarddiff-general-xj">(8.7)</a> правило дифференцирования сложной функции, получаем</p>
<div class="math notranslate nohighlight">
\[\frac{\partial x_j}{\partial x_i}
= \sum_{k \in K} \frac{\partial x_j}{\partial x_k} \frac{\partial x_k}{\partial x_i},\]</div>
<p>где производные <span class="math notranslate nohighlight">\(\partial x_k / \partial x_i\)</span> известны с предыдущих шагов обхода графа вычислений.
В свою очередь, производные <span class="math notranslate nohighlight">\(\partial x_j / \partial x_k\)</span> вычисляются на текущем шаге обхода по явной связи <span class="math notranslate nohighlight">\(x_j(\{ x_k \}_{k \in K})\)</span>.</p>
</section>
<section id="id4">
<h2><span class="section-number">8.4.2. </span>Быстродействие и применимость<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h2>
<p>Пусть стоит задача вычисления градиента функции вида <span class="math notranslate nohighlight">\(f: \real^n \to \real\)</span></p>
<div class="math notranslate nohighlight">
\[\frac{\partial f}{\partial x_i},\ i = 1, \dots, n.\]</div>
<p>В этой задаче автоматическому дифференцированию вперёд требуется <span class="math notranslate nohighlight">\(n\)</span> проходов графа вычислений, по одному проходу на каждую производную.</p>
<p>Если же стоит задача найти производные функции <span class="math notranslate nohighlight">\(f: \real \to \real^m\)</span>, т.е.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial f_j}{\partial x},\ j = 1, \dots, m,\]</div>
<p>то автоматическому дифференцированию вперёд требуется всего один проход графа вычислений.</p>
<p>В общем случае функции вида <span class="math notranslate nohighlight">\(f: \real^n \to \real^m\)</span> автоматическое дифференцирование вперёд эффективно для вычисления матрицы Якоби при <span class="math notranslate nohighlight">\(n \ll m\)</span>.</p>
<p>Кроме того, автоматическое дифференцирование вперёд не требует хранения графа вычислений в явном виде, поскольку проход(ы) по графу происходит только в одну сторону.
Другими словами, на практике для реализации нужен не сам граф вычислений, а лишь последовательность инструкций, которые строит компилятор.
Особенно удобно реализовывать дифференцирование вперёд на языках программирования, в которых можно перегрузить операторы и функции.
В этом мы убедились в <a class="reference internal" href="dualnumbers.html#sec-autodiff-dualnumbers"><span class="std std-numref">Разделе 8.2 (Дуальные числа)</span></a>.</p>
<p>Возможность не хранить граф вычислений актуальна для задач с большим количеством параметров, например, при минимизации функции ошибки.
В этом случае ограничение по памяти проще удовлетворить.</p>
<p>Итак, автоматическое дифференцирование вперёд эффективно по памяти, быстро работает для вычисления строк матрицы Якоби, но медленно для вычисления её столбцов или градиента функции.
Однако, строки матрицы Якоби не так часто нужны на практике, как градиенты функций.
Поэтому для автоматического вычисления градиентов чаще используется дифференцирование назад, о котором речь пойдёт в следующем разделе.</p>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Воспользоваться автоматическим дифференцированием вперёд в Julia можно, например, с помощью пакета <a class="reference external" href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>, <span id="id5">[<a class="reference internal" href="../appendix/bibliography.html#id24" title="J. Revels, M. Lubin, and T. Papamarkou. Forward-mode automatic differentiation in Julia. arXiv:1607.07892 [cs.MS], 2016. URL: https://arxiv.org/abs/1607.07892.">RLP16</a>]</span>.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./autodiff"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="compgraph.html"
       title="предыдущая страница">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">назад</p>
        <p class="prev-next-title"><span class="section-number">8.3. </span>Граф вычислений</p>
      </div>
    </a>
    <a class="right-next"
       href="backwardmode.html"
       title="следующая страница">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">вперёд</p>
        <p class="prev-next-title"><span class="section-number">8.5. </span>Автоматическое дифференцирование назад</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Содержание
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">8.4.1. Общий случай</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">8.4.2. Быстродействие и применимость</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
По Степан Захаров и Василий Писарев
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Копирайт 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>